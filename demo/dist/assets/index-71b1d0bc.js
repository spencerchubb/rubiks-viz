(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function St(i){const e=i.layers,t=i.gl,s=i.perspectiveMatrix;let n=tt(e,1.01,.02),r=tt(e,1,0),a=tt(e,1.5,.02);const o=Array(R(e));for(let c=0;c<R(e);c++){let h={positionBuffer:t.createBuffer(),noGapPositionBuffer:t.createBuffer(),hintPositionBuffer:t.createBuffer(),indexBuffer:t.createBuffer(),cart2d:[],positions:null},f=new Float32Array(12),l=new Float32Array(12),m=new Float32Array(12);for(let p=0;p<12;p++){let k=c*12+p;f[p]=n[k],l[p]=r[k],m[p]=a[k]}t.bindBuffer(t.ARRAY_BUFFER,h.positionBuffer),t.bufferData(t.ARRAY_BUFFER,f,t.STATIC_DRAW),h.positions=f,t.bindBuffer(t.ARRAY_BUFFER,h.noGapPositionBuffer),t.bufferData(t.ARRAY_BUFFER,l,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,h.hintPositionBuffer),t.bufferData(t.ARRAY_BUFFER,m,t.STATIC_DRAW);const u=Array(16);X(u,0,s,[l[0],l[1],l[2],1]),X(u,4,s,[l[3],l[4],l[5],1]),X(u,8,s,[l[6],l[7],l[8],1]),X(u,12,s,[l[9],l[10],l[11],1]),h.cart2d=[u[0]/u[3],u[1]/u[3],u[4]/u[7],u[5]/u[7],u[8]/u[11],u[9]/u[11],u[12]/u[15],u[13]/u[15]];const b=[0,1,2,0,2,3];t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),t.STATIC_DRAW),o[c]=h}return o}function X(i,e,t,s){let n=s[0],r=s[1],a=s[2],o=s[3];i[e+0]=n*t[0]+r*t[4]+a*t[8]+o*t[12],i[e+1]=n*t[1]+r*t[5]+a*t[9]+o*t[13],i[e+2]=n*t[2]+r*t[6]+a*t[10]+o*t[14],i[e+3]=n*t[3]+r*t[7]+a*t[11]+o*t[15]}const kt=12,vt=4,Q=3;function tt(i,e,t){const s=d(i)*kt,n=Array(6*s);return Et(n,0*s,i,1,e,t),Pt(n,1*s,i,0,e,t),Ot(n,2*s,i,1,-e,t),Lt(n,3*s,i,0,-e,t),Mt(n,4*s,i,2,-e,t),Dt(n,5*s,i,2,e,t),n}function Et(i,e,t,s,n,r){if(G(t)){let c=Array(d(t)),h=0;for(let f=0;f<t;f++)for(let l=0;l<t;l++){const m=-1+1/t+l*2/t,u=-1+1/t+f*2/t;c[h]=[m,u,n],h++}S(i,e,t,c,s,r);return}let a=Array(d(t)),o=0;for(let c=-x(t);c<=x(t);c++)for(let h=-x(t);h<=x(t);h++)a[o]=[2*h/t,2*c/t,n],o++;S(i,e,t,a,s,r)}function Pt(i,e,t,s,n,r){if(G(t)){let c=Array(d(t)),h=0;for(let f=0;f<t;f++)for(let l=t-1;l>=0;l--){const m=-1+1/t+f*2/t,u=-1+1/t+l*2/t;c[h]=[m,u,n],h++}S(i,e,t,c,s,r);return}let a=Array(d(t)),o=0;for(let c=-x(t);c<=x(t);c++)for(let h=x(t);h>=-x(t);h--)a[o]=[2*c/t,2*h/t,n],o++;S(i,e,t,a,s,r)}function Ot(i,e,t,s,n,r){if(G(t)){let c=Array(d(t)),h=0;for(let f=0;f<t;f++)for(let l=t-1;l>=0;l--){const m=-1+1/t+l*2/t,u=-1+1/t+f*2/t;c[h]=[m,u,n],h++}S(i,e,t,c,s,r);return}let a=Array(d(t)),o=0;for(let c=-x(t);c<=x(t);c++)for(let h=x(t);h>=-x(t);h--)a[o]=[2*h/t,2*c/t,n],o++;S(i,e,t,a,s,r)}function Lt(i,e,t,s,n,r){if(G(t)){let c=Array(d(t)),h=0;for(let f=0;f<t;f++)for(let l=0;l<t;l++){const m=-1+1/t+f*2/t,u=-1+1/t+l*2/t;c[h]=[m,u,n],h++}S(i,e,t,c,s,r);return}let a=Array(d(t)),o=0;for(let c=-x(t);c<=x(t);c++)for(let h=-x(t);h<=x(t);h++)a[o]=[2*c/t,2*h/t,n],o++;S(i,e,t,a,s,r)}function Mt(i,e,t,s,n,r){if(G(t)){let c=Array(d(t)),h=0;for(let f=0;f<t;f++)for(let l=t-1;l>=0;l--){const m=-1+1/t+l*2/t,u=-1+1/t+f*2/t;c[h]=[m,u,n],h++}S(i,e,t,c,s,r);return}let a=Array(d(t)),o=0;for(let c=-x(t);c<=x(t);c++)for(let h=x(t);h>=-x(t);h--)a[o]=[2*h/t,2*c/t,n],o++;S(i,e,t,a,s,r)}function Dt(i,e,t,s,n,r){if(G(t)){let c=Array(d(t)),h=0;for(let f=t-1;f>=0;f--)for(let l=t-1;l>=0;l--){const m=-1+1/t+l*2/t,u=-1+1/t+f*2/t;c[h]=[m,u,n],h++}S(i,e,t,c,s,r);return}let a=Array(d(t)),o=0;for(let c=x(t);c>=-x(t);c--)for(let h=x(t);h>=-x(t);h--)a[o]=[2*h/t,2*c/t,n],o++;S(i,e,t,a,s,r)}function S(i,e,t,s,n,r){for(let a=0;a<d(t);a++){const o=s[a];Ft(i,e+a*kt,t,o[0],o[1],o[2],n,r)}}function Ft(i,e,t,s,n,r,a,o){const c=1/t-o,h=[[s-c,n-c,r],[s+c,n-c,r],[s+c,n+c,r],[s-c,n+c,r]];for(let f=0;f<vt;f++){const l=h[f];i[e+f*Q]=l[(a+0)%Q],i[e+f*Q+1]=l[(a+1)%Q],i[e+f*Q+2]=l[(a+2)%Q]}}const Bt=[1,1,1,1],Ct=[1,1,0,1],_t=[0,1,0,1],Ut=[0,0,1,1],Kt=[1,.5,0,1],wt=[1,0,0,1],It=[0,0,0,1],ht=[Bt,_t,Ct,Ut,Kt,wt];function ut(i){return(i<0||i>=ht.length)&&console.error("Invalid face: "+i),ht[i]}function q(i){return Math.floor(Math.random()*i)}function Yt(i){let e=i.length;for(;e!=0;){let t=q(e);e--;let s=i[t];i[t]=i[e],i[e]=s}return i}const w=0,I=1,Y=2,H=3,N=4,z=5,Ht=[[w,H,N],[w,z,H],[w,N,I],[w,I,z],[Y,I,N],[Y,z,I],[Y,N,H],[Y,H,z]],Nt=[[w,H],[w,N],[w,z],[w,I],[I,N],[I,z],[Y,I],[Y,N],[Y,z],[Y,H],[H,N],[H,z]];function zt(i){let e=lt(12,2),t=lt(8,3),s=et(8),n=et(12);for(;ft(s)!==ft(n);)s=et(8);const r=Array(54);for(let A=0;A<6;A++){const O=i.center(A);r[O]=A}let a=i.corners(0,0),o=i.corners(1,0),c=i.corners(2,0),h=i.corners(3,0),f=i.corners(4,0),l=i.corners(5,0);const m=(A,O,W,L,M,D,F,B,C)=>{const T=(v,_)=>Ht[s[v]][(t[v]+_)%3];r[A.topLeft]=T(O,D),r[A.topRight]=T(W,F),r[A.bottomLeft]=T(L,B),r[A.bottomRight]=T(M,C)};m(a,0,1,2,3,0,0,0,0),m(o,2,3,4,5,2,1,1,2),m(c,4,5,6,7,0,0,0,0),m(h,6,7,0,1,2,1,1,2),m(f,0,2,6,4,2,1,1,2),m(l,3,1,5,7,2,1,1,2);let u=i.edges(0,0,0),b=i.edges(1,0,0),p=i.edges(2,0,0),k=i.edges(3,0,0),P=i.edges(4,0,0),j=i.edges(5,0,0);const g=(A,O,W,L,M,D,F,B,C)=>{const T=(v,_)=>Nt[n[v]][(e[v]+_)%2];r[A.top]=T(O,D),r[A.left]=T(W,F),r[A.right]=T(L,B),r[A.bottom]=T(M,C)};return g(u,0,1,2,3,0,0,0,0),g(b,3,4,5,6,1,0,0,1),g(p,6,7,8,9,0,0,0,0),g(k,9,10,11,0,1,0,0,1),g(P,1,10,4,7,1,1,1,1),g(j,2,5,11,8,1,1,1,1),r}function lt(i,e){const t=Array(i);for(let s=0;s<i;s++)t[s]=q(e);for(;!jt(t,e);){const s=q(i);t[s]=q(e)}return t}function jt(i,e){let t=0;for(let s=0;s<i.length;s++)t+=i[s];return t%e===0}function et(i){const e=Array(i);for(let t=0;t<i;t++)e[t]=t;return Yt(e),e}function ft(i){const e=[...i];let t=!1;for(;;)if(e[0]===0){const s=e.findIndex((n,r)=>n!==r);if(s===-1)return t;e[0]=e[s],e[s]=0,t=!t}else{const s=e[0];e[0]=e[s],e[s]=s,t=!t}}let K;function it(i,e){const t=[e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3],e[0],e[1],e[2],e[3]];K.bindBuffer(K.ARRAY_BUFFER,i.buffer),K.bufferData(K.ARRAY_BUFFER,new Float32Array(t),K.STATIC_DRAW)}function d(i){return i*i}function x(i){return Math.floor(i/2)}function G(i){return i%2==0}function R(i){return i*i*6}class Wt{constructor(e,t){K=e,this.animationQueue=[],this.gl=e,this.perspectiveMatrix=t,this.setNumOfLayers(3),this.solve()}setColors(e){for(let t=0;t<R(this.layers);t++)it(this.stickers[t],e[t])}solve(){const e=Array(R(this.layers));for(let t=0;t<R(this.layers);t++){const s=this.stickerToFace(t);this.stickers[t].face=s,e[t]=ut(s)}this.setColors(e)}scramble(){if(this.layers===3){this.scramble3x3();return}this.naiveScramble()}scramble3x3(){const e=zt(this);this.setCubeState(e)}naiveScramble(){let e=d(this.layers)*10;for(let t=0;t<e;t++){let s=Math.floor(Math.random()*3),n=Math.floor(Math.random()*this.layers),r=Math.floor(Math.random()*1)==0;this.matchTurn(s,n,r)}}setNumOfLayers(e){this.layers=e,this.stickers=Array(R(e)),this.underStickers=Array(R(e));for(let t=0;t<R(e);t++){const s=this.stickerToFace(t);this.stickers[t]={face:s,buffer:K.createBuffer()},this.underStickers[t]={face:s,buffer:K.createBuffer()},it(this.underStickers[t],It)}this.affectedStickers=Array(R(e)).fill(!1),this.buffers=St(this),this.solve()}getCubeState(){return this.stickers.map(e=>e.face)}setCubeState(e){for(let t=0;t<R(this.layers);t++){const s=ut(e[t]);this.stickers[t].face=e[t],it(this.stickers[t],s)}}resetAffectedStickers(){const e=Array(R(this.layers));this.affectedStickers=e.fill(this.layers===1)}pushAnimation(e,t,s){let n=t?-1:1,r=[0,0,0];r[e]=n,this.animationQueue.push({axis:r,stickers:s,stickersToAnimate:this.affectedStickers})}turn(e,t,s){this.resetAffectedStickers(),this.pushAnimation(e,s,[...this.stickers]),this.matchTurn(e,t,s)}sliceTurn(e,t){const s=Array(R(this.layers));this.affectedStickers=s.fill(!1),this.pushAnimation(e,t,[...this.stickers]);for(let n=1;n<this.layers-1;n++)this.matchTurn(e,n,t)}wideTurn(e,t,s){this.resetAffectedStickers(),this.pushAnimation(e,s,[...this.stickers]),this.matchTurn(e,t,s);for(let n=1;n<this.layers-1;n++)this.matchTurn(e,n,s)}cubeRotate(e,t){this.resetAffectedStickers(),this.pushAnimation(e,t,[...this.stickers]);for(let s=0;s<this.layers;s++)this.matchTurn(e,s,t)}matchTurn(e,t,s){e==0?(this.turnXAxis(t,s),t==0?this.turnOuter(5,s):t==this.layers-1&&this.turnOuter(4,!s)):e==1?(this.turnYAxis(t,s),t==0?this.turnOuter(0,s):t==this.layers-1&&this.turnOuter(2,!s)):e==2?(this.turnZAxis(t,s),t==0?this.turnOuter(1,s):t==this.layers-1&&this.turnOuter(3,!s)):console.error(`Axis ${e} not recognized`)}turnXAxis(e,t){for(let s=1;s<=this.layers;s++)this.cycle(t,0*d(this.layers)+d(this.layers)-s-e*this.layers,3*d(this.layers)+d(this.layers)-s-e*this.layers,2*d(this.layers)+d(this.layers)-s-e*this.layers,1*d(this.layers)+d(this.layers)-s-e*this.layers)}turnYAxis(e,t){for(let s=0;s<this.layers;s++)this.cycle(t,1*d(this.layers)+s*this.layers+e,4*d(this.layers)+s*this.layers+e,3*d(this.layers)+(this.layers-s-1)*this.layers+(this.layers-1)-e,5*d(this.layers)+s*this.layers+e)}turnZAxis(e,t){for(let s=0;s<this.layers;s++)this.cycle(t,0*d(this.layers)+(s+1)*this.layers-1-e,5*d(this.layers)+s+this.layers*e,2*d(this.layers)+(this.layers-s-1)*this.layers+e,4*d(this.layers)+d(this.layers)-(s+1)-e*this.layers)}turnOuter(e,t){if(this.layers%2!=0){let s=this.center(e);this.affectedStickers[s]=!0}for(let s=0;s<Math.floor(this.layers/2);s++){const{topLeft:n,topRight:r,bottomLeft:a,bottomRight:o}=this.corners(e,s);this.cycle(t,n,r,o,a);let c=this.layers-2*(s+1);for(let h=0;h<c;h++){const{top:f,left:l,bottom:m,right:u}=this.edges(e,s,h);this.cycle(t,f,u,m,l)}}}cycle(e,t,s,n,r){this.affectedStickers[t]=!0,this.affectedStickers[s]=!0,this.affectedStickers[n]=!0,this.affectedStickers[r]=!0,e?this.cycleHelper(t,s,n,r):this.cycleHelper(r,n,s,t)}cycleHelper(e,t,s,n){let r=this.stickers[n];this.stickers[n]=this.stickers[s],this.stickers[s]=this.stickers[t],this.stickers[t]=this.stickers[e],this.stickers[e]=r}matchKeyToTurn(e){if(!this.disableTurn&&!e.ctrlKey)return this.matchKeyCodeToTurn(e.code)}matchKeyCodeToTurn(e){switch(e){case"KeyN":return this.cubeRotate(0,!0),{notation:"x",rotate:!0};case"KeyB":return this.cubeRotate(0,!1),{notation:"x'",rotate:!0};case"Semicolon":return this.cubeRotate(1,!0),{notation:"y",rotate:!0};case"KeyA":return this.cubeRotate(1,!1),{notation:"y'",rotate:!0};case"KeyP":return this.cubeRotate(2,!0),{notation:"z",rotate:!0};case"KeyQ":return this.cubeRotate(2,!1),{notation:"z'",rotate:!0};case"KeyJ":return this.turn(1,0,!0),{notation:"U",turn:!0};case"KeyF":return this.turn(1,0,!1),{notation:"U'",turn:!0};case"KeyS":return this.turn(1,this.layers-1,!1),{notation:"D",turn:!0};case"KeyL":return this.turn(1,this.layers-1,!0),{notation:"D'",turn:!0};case"KeyH":return this.turn(2,0,!0),{notation:"F",turn:!0};case"KeyG":return this.turn(2,0,!1),{notation:"F'",turn:!0};case"KeyW":return this.turn(2,this.layers-1,!1),{notation:"B",turn:!0};case"KeyO":return this.turn(2,this.layers-1,!0),{notation:"B'",turn:!0};case"KeyD":return this.turn(0,this.layers-1,!1),{notation:"L",turn:!0};case"KeyE":return this.turn(0,this.layers-1,!0),{notation:"L'",turn:!0};case"KeyI":return this.turn(0,0,!0),{notation:"R",turn:!0};case"KeyK":return this.turn(0,0,!1),{notation:"R'",turn:!0};case"BracketLeft":return this.sliceTurn(0,!1),{notation:"M",turn:!0};case"Quote":return this.sliceTurn(0,!0),{notation:"M'",turn:!0};case"KeyC":return this.sliceTurn(1,!1),{notation:"E",turn:!0};case"Comma":return this.sliceTurn(1,!0),{notation:"E'",turn:!0};case"KeyY":return this.sliceTurn(2,!0),{notation:"S",turn:!0};case"KeyT":return this.sliceTurn(2,!1),{notation:"S'",turn:!0};case"KeyU":return this.wideTurn(0,0,!0),{notation:"r",turn:!0};case"KeyM":return this.wideTurn(0,0,!1),{notation:"r'",turn:!0};case"KeyV":return this.wideTurn(0,this.layers-1,!1),{notation:"l",turn:!0};case"KeyR":return this.wideTurn(0,this.layers-1,!0),{notation:"l'",turn:!0}}}performMove(e,t){switch(e){case"x":this.cubeRotate(0,t);break;case"x'":this.cubeRotate(0,!t);break;case"x2":case"x2'":this.cubeRotate(0,t),this.cubeRotate(0,t);break;case"y":this.cubeRotate(1,t);break;case"y'":this.cubeRotate(1,!t);break;case"y2":case"y2'":this.cubeRotate(1,t),this.cubeRotate(1,t);break;case"z":this.cubeRotate(2,t);break;case"z'":this.cubeRotate(2,!t);break;case"z2":case"z2'":this.cubeRotate(2,t),this.cubeRotate(2,t);break;case"U":this.turn(1,0,t);break;case"U'":this.turn(1,0,!t);break;case"U2":case"U2'":this.turn(1,0,t),this.turn(1,0,t);break;case"u":this.wideTurn(1,0,t);break;case"u'":this.wideTurn(1,0,!t);break;case"u2":case"u2'":this.wideTurn(1,0,t),this.wideTurn(1,0,t);break;case"D":this.turn(1,this.layers-1,!t);break;case"D'":this.turn(1,this.layers-1,t);break;case"D2":case"D2'":this.turn(1,this.layers-1,t),this.turn(1,this.layers-1,t);break;case"d":this.wideTurn(1,this.layers-1,!t);break;case"d'":this.wideTurn(1,this.layers-1,t);break;case"d2":case"d2'":this.wideTurn(1,this.layers-1,t),this.wideTurn(1,this.layers-1,t);break;case"F":this.turn(2,0,t);break;case"F'":this.turn(2,0,!t);break;case"F2":case"F2'":this.turn(2,0,t),this.turn(2,0,t);break;case"f":this.wideTurn(2,0,t);break;case"f'":this.wideTurn(2,0,!t);break;case"f2":case"f2'":this.wideTurn(2,0,t),this.wideTurn(2,0,t);break;case"B":this.turn(2,this.layers-1,!t);break;case"B'":this.turn(2,this.layers-1,t);break;case"B2":case"B2'":this.turn(2,this.layers-1,t),this.turn(2,this.layers-1,t);break;case"b":this.wideTurn(2,this.layers-1,!t);break;case"b'":this.wideTurn(2,this.layers-1,t);break;case"b2":case"b2'":this.wideTurn(2,this.layers-1,t),this.wideTurn(2,this.layers-1,t);break;case"L":this.turn(0,this.layers-1,!t);break;case"L'":this.turn(0,this.layers-1,t);break;case"L2":case"L2'":this.turn(0,this.layers-1,t),this.turn(0,this.layers-1,t);break;case"l":this.wideTurn(0,this.layers-1,!t);break;case"l'":this.wideTurn(0,this.layers-1,t);break;case"l2":case"l2'":this.wideTurn(0,this.layers-1,t),this.wideTurn(0,this.layers-1,t);break;case"R":this.turn(0,0,t);break;case"R'":this.turn(0,0,!t);break;case"R2":case"R2'":this.turn(0,0,t),this.turn(0,0,t);break;case"r":this.wideTurn(0,0,t);break;case"r'":this.wideTurn(0,0,!t);break;case"r2":case"r2'":this.wideTurn(0,0,t),this.wideTurn(0,0,t);break;case"M":this.turn(0,1,!t);break;case"M'":this.turn(0,1,t);break;case"M2":case"M2'":this.sliceTurn(0,t),this.sliceTurn(0,t);break;case"E":this.sliceTurn(1,!t);break;case"E'":this.sliceTurn(1,t);break;case"E2":case"E2'":this.sliceTurn(1,t),this.sliceTurn(1,t);break;case"S":this.sliceTurn(2,t);break;case"S'":this.sliceTurn(2,!t);break;case"S2":case"S2'":this.sliceTurn(2,t);default:throw new Error("Invalid turn in algorithm: "+e)}}performAlg(e){if(!e)return;let t=e.split(" ");for(let s=0;s<t.length;s++)this.performMove(t[s],!0);this.animationQueue=[]}performAlgReverse(e){if(!e)return;let t=e.split(" ");for(let s=t.length-1;s>=0;s--)this.performMove(t[s],!1);this.animationQueue=[]}stickerIsOnFace(e,t){return t*d(this.layers)<=e&&e<(t+1)*d(this.layers)}stickerToFace(e){return Math.floor(e/d(this.layers))}center(e){return e*d(this.layers)+Math.floor(d(this.layers)/2)}corners(e,t){const s=e*d(this.layers);return{topLeft:s+(this.layers+1)*t,topRight:s+(this.layers-1)*(this.layers-t),bottomRight:s+(this.layers+1)*(this.layers-t-1),bottomLeft:s+(this.layers-1)*(t+1)}}edges(e,t,s){const n=this.corners(e,t);let r=this.layers-2*(t+1);return{top:n.topLeft+this.layers*(s+1),left:n.topLeft+(r-s),right:n.topRight+s+1,bottom:n.bottomLeft+this.layers*(r-s)}}}function dt(i,e){return i/e*2-1}function mt(i,e){return 1-i/e*2}function st(i,e,t,s){return i<t?(s-e)/(t-i):(e-s)/(i-t)}function V(i,e,t,s,n,r){return Math.abs(.5*(i*(s-r)+t*(r-e)+n*(e-s)))}function Qt(i,e){return i.layers-1-e%i.layers}function nt(i,e){return i.layers-1-Math.floor(e/i.layers)}function Vt(i,e){return e%i.layers}function rt(i,e){return i.layers-1-Math.floor((e-d(i.layers))/i.layers)}class Gt{onPointerDown(e,t,s,n){const r=n.buffers;this.numOfPointerMoves=0;const a=dt(e,s.clientWidth),o=mt(t,s.clientHeight);this.xOnDown=a,this.yOnDown=o,[this.stickerOnDown,this.cart2dOnDown]=this._coordinatesToSticker(a,o,n,r);function c(p,k,P){return{x:r[p].cart2d[k],y:r[p].cart2d[P]}}if(this.stickerOnDown!==-1)return;const h=c(0,0,1),f=c(n.layers*(n.layers-1),6,7),l=c(n.layers-1,2,3),m=c(d(n.layers)-1,4,5),u=c(n.layers*(n.layers+1)-1,0,1),b=c(d(n.layers)*2-1,2,3);o>h.y&&a>h.x&&a<f.x?n.cubeRotate(0,!0):a<h.x&&o>l.y&&o<h.y?n.cubeRotate(2,!1):a>f.x&&o>m.y&&o<f.y?n.cubeRotate(2,!0):a<u.x&&o>u.y&&o<l.y?n.cubeRotate(1,!0):a>b.x&&o>b.y&&o<m.y?n.cubeRotate(1,!1):o<u.y&&a>u.x&&a<b.x&&n.cubeRotate(0,!1)}onPointerMove(e,t){this.numOfPointerMoves++,this.xOnMove=e,this.yOnMove=t}onPointerUp(e,t){if(this.numOfPointerMoves<2)return;let s,n;if(this.stickerOnDown!==-1&&(s=st(this.cart2dOnDown[0],this.cart2dOnDown[1],this.cart2dOnDown[4],this.cart2dOnDown[5]),n=st(this.cart2dOnDown[2],this.cart2dOnDown[3],this.cart2dOnDown[6],this.cart2dOnDown[7]),s<0)){const c=s;s=n,n=c}const r=dt(this.xOnMove,e.clientWidth),a=mt(this.yOnMove,e.clientHeight),o=st(r,a,this.xOnDown,this.yOnDown);t.stickerIsOnFace(this.stickerOnDown,0)?r===this.xOnDown?t.turn(0,nt(t,this.stickerOnDown),a>this.yOnDown):o>s?t.turn(0,nt(t,this.stickerOnDown),r>this.xOnDown):o<n?t.turn(0,nt(t,this.stickerOnDown),r<this.xOnDown):t.turn(2,Qt(t,this.stickerOnDown),r>this.xOnDown):t.stickerIsOnFace(this.stickerOnDown,1)&&(r===this.xOnDown?t.turn(0,rt(t,this.stickerOnDown),a>this.yOnDown):o>s?t.turn(0,rt(t,this.stickerOnDown),r>this.xOnDown):o<n?t.turn(0,rt(t,this.stickerOnDown),r<this.xOnDown):t.turn(1,Vt(t,this.stickerOnDown),r<this.xOnDown))}_coordinatesToSticker(e,t,s,n){const r=a=>{if(!n[a].cart2d){console.error("cart2d is undefined");return}const o=n[a].cart2d,c=V(o[0],o[1],o[2],o[3],o[4],o[5])+V(o[0],o[1],o[4],o[5],o[6],o[7]),h=V(e,t,o[0],o[1],o[2],o[3])+V(e,t,o[2],o[3],o[4],o[5])+V(e,t,o[4],o[5],o[6],o[7])+V(e,t,o[6],o[7],o[0],o[1]),f=1e-5;if(Math.abs(c-h)<f)return[a,o]};for(let a=0;a<2*d(s.layers);a++){const o=r(a);if(o)return o}return[-1,void 0]}}function $(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Xt(i,e,t,s,n){const r=1/Math.tan(e/2);if(i[0]=r/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,n!=null&&n!==1/0){const a=1/(s-n);i[10]=(n+s)*a,i[14]=2*n*s*a}else i[10]=-1,i[14]=-2*s;return i}function Z(i,e,t,s){let n=s[0],r=s[1],a=s[2],o=1/Math.hypot(n,r,a);n*=o,r*=o,a*=o;let c=Math.sin(t),h=Math.cos(t),f=1-h,l=e[0],m=e[1],u=e[2],b=e[3],p=e[4],k=e[5],P=e[6],j=e[7],g=e[8],A=e[9],O=e[10],W=e[11],L=n*n*f+h,M=r*n*f+a*c,D=a*n*f-r*c,F=n*r*f-a*c,B=r*r*f+h,C=a*r*f+n*c,T=n*a*f+r*c,v=r*a*f-n*c,_=a*a*f+h;return i[0]=l*L+p*M+g*D,i[1]=m*L+k*M+A*D,i[2]=u*L+P*M+O*D,i[3]=b*L+j*M+W*D,i[4]=l*F+p*B+g*C,i[5]=m*F+k*B+A*C,i[6]=u*F+P*B+O*C,i[7]=b*F+j*B+W*C,i[8]=l*T+p*v+g*_,i[9]=m*T+k*v+A*_,i[10]=u*T+P*v+O*_,i[11]=b*T+j*v+W*_,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i}function qt(i,e){let t=e[0],s=e[1],n=e[2];return i[12]+=i[0]*t+i[4]*s+i[7]*n,i[13]+=i[1]*t+i[5]*s+i[8]*n,i[14]+=i[2]*t+i[5]*s+i[9]*n,i[15]+=i[3]*t+i[6]*s+i[10]*n,i}function pt(){let i;return e=>(i||(i=e()),i)}const $t=100,Zt=15;class Jt{constructor(){this.position=0,this._velocity=200,this._acceleration=0,this.target=0}update(e){const t=-$t*(this.position-this.target),s=-Zt*this._velocity;this._acceleration=t+s,this._velocity+=this._acceleration*e,this.position+=this._velocity*e}}let E=At(),y=te(E),U=ee(y);function At(){const i=document.createElement("canvas");return i.style.position="fixed",i.style.display="block",i.style.top="0",i.style.left="0",i.style.width="100vw",i.style.height="100vh",i.style.zIndex="-1",document.body.appendChild(i),document.addEventListener("keydown",e=>{J.forEach(t=>{t.keysEnabled&&t.cube.matchKeyToTurn(e)})}),i}function te(i){return i.getContext("webgl")}function ee(i){const s=re(i,`
    attribute vec4 aVertexPosition;
    attribute vec4 aVertexColor;
    uniform mat4 uTransformMatrix;
    uniform mat4 uRotateMatrix;

    // variables shared between vertex and fragment shaders
    varying lowp vec4 vColor;
    varying lowp vec4 originalPos;
    varying lowp vec4 rotatedPos;
    void main(void) {
        gl_Position = uTransformMatrix * aVertexPosition;
        originalPos = aVertexPosition;
        rotatedPos = uRotateMatrix * aVertexPosition;
        vColor = aVertexColor;
    }
    `,`
    // variables shared between vertex and fragment shaders
    varying lowp vec4 vColor;
    varying lowp vec4 originalPos;
    varying lowp vec4 rotatedPos;

    void main(void) {
        gl_FragColor = vColor;

        // low precision float variable
        lowp float max = 1.05;

        // if it is a normal sticker rather than a hint sticker, it should not be discarded
        if (originalPos.x < max && originalPos.x > -max && originalPos.y < max && originalPos.y > -max && originalPos.z < max && originalPos.z > -max) {
            return;
        }

        // if it starts on the right or left, and stays on its side, it should not be discarded
        if (originalPos.x > max && rotatedPos.x > max) return;
        if (originalPos.x < -max && rotatedPos.x < -max) return;

        if (rotatedPos.y < max && rotatedPos.z < max) return;
        discard;
    }
    `);return i.useProgram(s),{attribLocations:{vertexPosition:i.getAttribLocation(s,"aVertexPosition"),vertexColor:i.getAttribLocation(s,"aVertexColor")},uniformLocations:{transformMatrix:i.getUniformLocation(s,"uTransformMatrix"),rotateMatrix:i.getUniformLocation(s,"uRotateMatrix")}}}let J=[],Tt=[],yt=Date.now()*.001,bt=!1;function ie(){bt||(bt=!0,requestAnimationFrame(Rt))}function se(i){At();let e=ne(i),t=new Wt(y,e),s=new Jt,n=new Gt,r={cube:t,dragEnabled:!0,keysEnabled:!0},a={cube:t,div:i,spring:s};const o=(u,b)=>{n.onPointerDown(u,b,i,r.cube)},c=(u,b)=>{n.onPointerMove(u,b)},h=()=>{n.onPointerUp(i,r.cube)},f=u=>{const b=u.target.getBoundingClientRect(),p=u.touches[0].pageX-b.left,k=u.touches[0].pageY-b.top;return{x:p,y:k}},l=()=>{i.addEventListener("pointerdown",u=>o(u.offsetX,u.offsetY)),i.addEventListener("pointermove",u=>c(u.offsetX,u.offsetY)),i.addEventListener("pointerup",()=>h())},m=()=>{i.addEventListener("touchstart",u=>{const{x:b,y:p}=f(u);o(b,p)}),i.addEventListener("touchmove",u=>{const{x:b,y:p}=f(u);c(b,p)}),i.addEventListener("touchend",()=>{h()})};return window.PointerEvent?l():m(),J.push(r),Tt.push(a),ie(),r}function ne(i){let e=$();return Xt(e,50*Math.PI/180,i.clientWidth/i.clientHeight,.1,100),qt(e,[0,0,-5]),Z(e,e,45*Math.PI/180,[1,0,0]),Z(e,e,0,[0,-1,0]),e}function ot(i,e,t){t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(e.attribLocations.vertexPosition,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.attribLocations.vertexPosition)}function at(i,e,t){t.bindBuffer(t.ARRAY_BUFFER,i),t.vertexAttribPointer(e.attribLocations.vertexColor,4,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.attribLocations.vertexColor)}function ct(i){i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0)}function re(i,e,t){const s=xt(i,i.VERTEX_SHADER,e),n=xt(i,i.FRAGMENT_SHADER,t),r=i.createProgram();return i.attachShader(r,s),i.attachShader(r,n),i.linkProgram(r),i.getProgramParameter(r,i.LINK_STATUS)?r:(alert("Unable to initialize the shader program: "+i.getProgramInfoLog(r)),null)}function xt(i,e,t){const s=i.createShader(e);return i.shaderSource(s,t),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)?s:(alert("An error occurred compiling the shaders: "+i.getShaderInfoLog(s)),i.deleteShader(s),null)}function oe(){const i=E.clientWidth,e=E.clientHeight,t=E.width!==i||E.height!==e;return t&&(E.width=i,E.height=e),t}function Rt(i){i*=.001;const e=i-yt;yt=i,oe(),y.enable(y.DEPTH_TEST),y.enable(y.SCISSOR_TEST),y.depthFunc(y.LEQUAL),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT);for(let t=0;t<J.length;t++){const{cube:s,div:n,spring:r}=Tt[t],a=n.getBoundingClientRect();if(a.bottom<0||a.top>E.clientHeight||a.right<0||a.left>E.clientWidth)continue;const o=a.right-a.left,c=a.bottom-a.top,h=a.left,f=E.clientHeight-a.bottom;y.viewport(h,f,o,c),y.scissor(h,f,o,c),s.animationQueue[0]&&(r.target=s.animationQueue.length*90,r.update(e),r.position>=90&&(s.affectedStickers=Array(R(s.layers)).fill(!1),r.position=0,s.animationQueue.shift()));const l=s.animationQueue[0];let m=ae(s),u=pt(),b=pt();for(let p=0;p<R(s.layers);p++){let k=s.buffers[p];const P=l&&l.stickersToAnimate[p]?u(()=>Z($(),s.perspectiveMatrix,r.position*Math.PI/180,l.axis)):s.perspectiveMatrix;y.uniformMatrix4fv(U.uniformLocations.transformMatrix,!1,P);const j=l&&l.stickersToAnimate[p]?b(()=>{const g=$();return Z(g,g,r.position*Math.PI/180,l.axis)}):$();y.uniformMatrix4fv(U.uniformLocations.rotateMatrix,!1,j),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,k.indexBuffer),ot(k.noGapPositionBuffer,U,y),at(s.underStickers[p].buffer,U,y),ct(y),ot(k.positionBuffer,U,y),at(m[p].buffer,U,y),ct(y),ot(k.hintPositionBuffer,U,y),at(m[p].buffer,U,y),ct(y)}}requestAnimationFrame(Rt)}function ae(i){return i.animationQueue[0]?i.animationQueue[0].stickers:i.stickers}const ce=document.querySelector("#scenesContainer"),he=gt(3);he.keysEnabled=!0;for(let i=1;i<10;i++)gt(i);function gt(i){let e=document.createElement("div");e.style.width="320px",e.style.height="320px",e.style.minWidth="320px",e.style.minHeight="320px",e.style.borderRadius="8px",e.style.boxShadow="rgb(255 255 255 / 20%) 0 4px 12px",e.style.touchAction="none",ce.appendChild(e);const t=se(e);return t.cube.setNumOfLayers(i),t.keysEnabled=!1,e.addEventListener("click",()=>{J.forEach(s=>s.keysEnabled=!1),t.keysEnabled=!0}),t}
